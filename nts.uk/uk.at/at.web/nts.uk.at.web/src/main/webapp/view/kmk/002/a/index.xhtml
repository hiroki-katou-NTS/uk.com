<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
   xmlns:ui="http://java.sun.com/jsf/facelets"
   xmlns:com="http://xmlns.jcp.org/jsf/component"
   xmlns:h="http://xmlns.jcp.org/jsf/html">
   <body>
      <ui:composition template="../../../../master/base.xhtml">
         <ui:define name="htmlHead">
            <com:ValidatorScript>
               nts.uk.ctx.at.record.dom.optitem.OptionalItemName
               nts.uk.ctx.at.record.dom.optitem.NumberRangeValue
               nts.uk.ctx.at.record.dom.optitem.TimeRangeValue
               nts.uk.ctx.at.record.dom.optitem.AmountRangeValue
               nts.uk.ctx.at.record.dom.optitem.calculation.FormulaName
               nts.uk.ctx.at.record.dom.optitem.UnitOfOptionalItem
            </com:ValidatorScript>
            <com:scriptfile set="IGNITE" />
            <com:stylefile path="kmk002.a.style.css" />
            <com:scriptfile path="kmk002.a.start.js" />
            <com:scriptfile path="kmk002.a.service.js" />
            <com:scriptfile path="kmk002.a.vm.js" />
         </ui:define>
         <ui:define name="content">
            <com:ko tag="with" bind="optionalItemHeader">
               <div id="functions-area">
                  <button tabindex="1" class="proceed" data-bind="click: saveOptionalItemDetail, enable: hasSelected">
                  #{i18n.getText('KMK002_1')}</button>
               </div>
               <div id="contents-area" style="display: none" data-bind="visible: true" class="fixed-flex-layout">
                  <!-- Optional item grid list. -->
                  <div class="opt-item-grid-list pull-left caret-right caret-background bg-green fixed-flex-layout-left">
                     <i class="icon icon-searchbox"></i>
                     <div tabindex="1" data-bind="ntsSearchBox: {
                        label: nts.uk.resource.getText('KMK002_2'),
                        targetKey: 'itemNo',
                        mode:'igGrid',
                        comId:'tbl-master-list',
                        items: optionalItemHeaders,
                        selected: selectedCode,
                        selectedKey: 'itemNo',
                        fields: ['itemNo', 'itemName']}"></div>
                     <table tabindex="1" id="tbl-master-list"
                        data-bind="ntsGridList: {
                        name: '#[KMK002_6]',
                        width: 300,
                        dataSource: optionalItemHeaders,
                        optionsValue: 'itemNo',
                        columns: columns,
                        multiple: false,
                        value: selectedCode,
                        rows: 15}">
                     </table>
                  </div>
                  <!-- Optional Item view model -->
                  <div class="pull-left opt-item-detail fixed-flex-layout-right">
                     <com:ko tag="with" bind="optionalItem">
                        <table class="control-group">
                           <tr>
                              <td>
                                 <div data-bind="ntsFormLabel: {required: true, constraint: 'OptionalItemName'}">#{i18n.getText('KMK002_11')}</div>
                              </td>
                              <td><input tabindex="1" id="inpName"
                                 data-bind="ntsTextEditor: {
                                 name: '#[KMK002_12]',
                                 value: optionalItemName,
                                 constraint: 'OptionalItemName', 
                                 enable: $parent.hasSelected, 
                                 required: true}"/></td>
                           </tr>
                           <tr>
                              <!-- optionalItemAtr -->
                              <td>
                                 <div data-bind="ntsFormLabel: {required: true}">#{i18n.getText('KMK002_24')}</div>
                              </td>
                              <td>
                                 <div tabindex="1" style="width: 80px"
                                    data-bind="ntsComboBox: {
                                    name: '#[KMK002_24]',
                                    options: atrDataSource,
                                    optionsValue: 'value',
                                    value: optionalItemAtr,
                                    optionsText: 'localizedName',
                                    editable: false,
                                    enable: true,
                                    columns: [
                                    { prop: 'localizedName', length: 2 },
                                    ]}">
                                 </div>
                              </td>
                              <td>
                              	<div data-bind="ntsFormLabel: {required: false}">#{i18n.getText('KMK002_75')}</div>
                              </td>
                              <td>
                              	<input tabindex="1" id="inp-unit" style="margin-left: 5px;"
                                    data-bind="ntsTextEditor: {
                                    name: '#[KMK002_75]',
                                    value: unit,
                                    enable: enableUnit,
                                    constraint: 'UnitOfOptionalItem',
                                    required: false}"/>
                              </td>
                           </tr>
                           <tr>
                              <!-- Usage Atr -->
                              <td>
                                 <div data-bind="ntsFormLabel: {required: true}">#{i18n.getText('KMK002_13')}</div>
                              </td>
                              <td>
                                 <div tabindex="1"
                                    data-bind="ntsSwitchButton: {
                                    name: '#[KMK002_13]',
                                    options: usageClsDatasource,
                                    optionsValue: 'code',
                                    optionsText: 'name',
                                    value: usageAtr,
                                    enable: $parent.hasSelected }"></div>
                              </td>
                           </tr>
                           <tr><td colspan="4"><hr/></td></tr>
                           <tr>
                              <!-- Performance Atr -->
                              <td>
                                 <div data-bind="ntsFormLabel: {required: true}">#{i18n.getText('KMK002_20')}</div>
                              </td>
                              <td>
                                 <div tabindex="1"
                                    data-bind="ntsSwitchButton: {
                                    name: '#[KMK002_21]',
                                    options: perfClsDatasource,
                                    optionsValue: 'code',
                                    optionsText: 'name',
                                    value: performanceAtr,
                                    enable: isUsed }"></div>
                              </td>
                              <!-- Calculation ResultRange -->
                              <td>
                                 <div data-bind="ntsFormLabel: {required: false}">#{i18n.getText('KMK002_25')}</div>
                              </td>
                              <td>
                              <div>
                                 <div tabindex="1" id="cb-upper"
                                    data-bind="ntsCheckBox: {
                                    name: '#[KMK002_26]',
                                    checked: calcResultRange.upperCheck,
                                    enable: isUsed,
                                    text: nts.uk.resource.getText('KMK002_26') }"></div>
                                 <com:ko tag="if" bind="isNumberSelected()">
                                    <input tabindex="1" id="inp-upper-number"
                                       data-bind="ntsNumberEditor: {
                                       name: '#[KMK002_26]',
                                       value: calcResultRange.numberUpper,
                                       constraint: 'NumberRangeValue',
                                       option: {
                                       grouplength: 3,
                                       decimallength: 1
                                       },
                                       required: true,
                                       enable: calcResultRange.upperCheck() &amp;&amp; isUsed()}"/>
                                 </com:ko>
                                 <com:ko tag="if" bind="isAmountSelected()">
                                    <input tabindex="1" id="inp-upper-amount"
                                       data-bind="ntsNumberEditor: {
                                       name: '#[KMK002_26]',
                                       value: calcResultRange.amountUpper,
                                       constraint: 'AmountRangeValue',
                                       option: {
                                       grouplength: 3
                                       },
                                       required: true,
                                       enable: calcResultRange.upperCheck() &amp;&amp; isUsed()}"/>
                                 </com:ko>
                                 <com:ko tag="if" bind="isTimeSelected()">
                                    <input tabindex="1" id="inp-upper-time"
                                       data-bind="ntsTimeEditor: {
                                       name: '#[KMK002_26]',
                                       value: calcResultRange.timeUpper,
                                       constraint: 'TimeRangeValue',
                                       inputFormat: 'time',
                                       mode: 'time',
                                       required: true,
                                       enable: calcResultRange.upperCheck() &amp;&amp; isUsed()}"/>
                                 </com:ko>
                                 </div>
                              </td>
                           </tr>
                           <tr>
                              <!-- EmpCondition Atr -->
                              <td>
                                 <div data-bind="ntsFormLabel: {required: true}">#{i18n.getText('KMK002_16')}</div>
                              </td>
                              <td>
                                 <div tabindex="1"
                                    data-bind="ntsSwitchButton: {
                                    name: '#[KMK002_16]',
                                    options: empConClsDatasource,
                                    optionsValue: 'code',
                                    optionsText: 'name',
                                    value: empConditionAtr,
                                    enable: isUsed }"></div>
                                 <button tabindex="1"
                                 data-bind="click: openDialogB, enable: empConditionAtr() == 1 &amp;&amp; isUsed">#{i18n.getText('KMK002_19')}</button>
                              </td>
                              <td></td>
                              <!-- Calculation ResultRange -->
                              <td>
                              <div>
                                 <div tabindex="1" id="cb-lower"
                                    data-bind="ntsCheckBox: {
                                    name: '#[KMK002_27]',
                                    checked: calcResultRange.lowerCheck,
                                    enable: isUsed,
                                    text: nts.uk.resource.getText('KMK002_27') }"></div>
                                 <com:ko tag="if" bind="isNumberSelected()">
                                    <input tabindex="1" id="inp-lower-number"
                                       data-bind="ntsNumberEditor: {
                                       name: '#[KMK002_27]',
                                       value: calcResultRange.numberLower,
                                       constraint: 'NumberRangeValue',
                                       option: {
                                       grouplength: 3,
                                       decimallength: 1
                                       },
                                       required: true,
                                       enable: calcResultRange.lowerCheck() &amp;&amp; isUsed()}"/>
                                 </com:ko>
                                 <com:ko tag="if" bind="isTimeSelected()">
                                    <input tabindex="1" id="inp-lower-time"
                                       data-bind="ntsTimeEditor: {
                                       name: '#[KMK002_27]',
                                       value: calcResultRange.timeLower,
                                       constraint: 'TimeRangeValue',
                                       inputFormat: 'time',
                                       mode: 'time',
                                       required: true,
                                       enable: calcResultRange.lowerCheck() &amp;&amp; isUsed()}"/>
                                 </com:ko>
                                 <com:ko tag="if" bind="isAmountSelected()">
                                    <input tabindex="1" id="inp-lower-amount"
                                       data-bind="ntsNumberEditor: {
                                       name: '#[KMK002_27]',
                                       value: calcResultRange.amountLower,
                                       constraint: 'AmountRangeValue',
                                       option: {
                                       grouplength: 3
                                       },
                                       required: true,
                                       enable: calcResultRange.lowerCheck() &amp;&amp; isUsed()}"/>
                                 </com:ko>
                                 </div>
                              </td>
                           </tr>
                           <!-- Optional Item view model -->
                           <tr>
                              <td><button tabindex="1" data-bind="click: addFormulaAbove, enable: isUsed">#{i18n.getText('KMK002_28')}</button></td>
                              <td>
                                 <button tabindex="1" data-bind="click: addFormulaBelow, enable: isUsed">#{i18n.getText('KMK002_29')}</button>
                                 <button tabindex="1" style="margin-left: 12px"
                                 data-bind="click: removeFormula, enable: isUsed() &amp;&amp; hasSelectedFormula()" class="danger">#{i18n.getText('KMK002_30')}</button>
                              </td>
                           </tr>
                           <tr>
                              <td colspan="5"><span>#{i18n.getText('KMK002_31')}</span>
                                 <input style="width: 700px; margin-left: 18px;" id="inp-apply-formula"
                                    data-bind="ntsTextEditor: {
                                    value: applyFormula,
                                    enable: isUsed,
                                    readonly: true,
                                    required: false}"/>
                              </td>
                           </tr>
                        </table>
                        <!-- Optional Item formula view model -->
                        <table id="tbl-calc-formula" data-bind="name: '#[KMK002_32]'">
                           <colgroup>
                              <col width="35px"/>
                              <col width="38px"/>
                              <col width="145px"/>
                              <col width="157px"/>
                              <col width="207px"/>
                              <col width="35px"/>
                              <col width="157px"/>
                              <col width="105px"/>
                              <col width="145px"/>
                              <col width="105px"/>
                              <col width="145px"/>
                           </colgroup>
                           <thead>
                              <tr>
                                 <th class="ui-widget-header">
                                    <div tabindex="-1" data-bind="ntsCheckBox: {
                                       checked: checkedAllFormula,
                                       enable: isUsed,
                                       text: '' }"></div>
                                 </th>
                                 <th class="ui-widget-header">#{i18n.getText('KMK002_33')}</th>
                                 <th class="ui-widget-header">#{i18n.getText('KMK002_24')}</th>
                                 <th class="ui-widget-header">#{i18n.getText('KMK002_34')}</th>
                                 <th colspan="3" class="ui-widget-header">#{i18n.getText('KMK002_35')}</th>
                                 <th class="ui-widget-header">#{i18n.getText('KMK002_36')}</th>
                                 <th class="ui-widget-header">#{i18n.getText('KMK002_37')}</th>
                                 <th class="ui-widget-header">#{i18n.getText('KMK002_38')}</th>
                                 <th class="ui-widget-header">#{i18n.getText('KMK002_39')}</th>
                              </tr>
                           </thead>
                           <tbody>
                              <com:ko tag="foreach" bind="calcFormulas">
                                 <tr>
                                    <td>
                                       <div tabindex="-1" data-bind="ntsCheckBox: {
                                          checked: selected,
                                          enable: $parent.isUsed,
                                          text: '' }"></div>
                                    </td>
                                    <td style="text-align: right" data-bind="text: symbolValue"></td>
                                    <td>
                                       <div tabindex="1" style="width: 80px" class="combo-table" data-bind="ntsComboBox: {
                                          name: '#[KMK002_24]',
                                          options: formulaAtrDs,
                                          optionsValue: 'value',
                                          value: formulaAtr,
                                          optionsText: 'localizedName',
                                          enable: $parent.isUsed,
                                          columns: [
                                          { prop: 'localizedName', length: 8 },
                                          ]}">
                                       </div>
                                    </td>
                                    <td><input tabindex="1" class="inp-formula-required"
                                    data-bind="attr: {'id': 'formulaName' + ($index() + 1)},
                                    ntsTextEditor: {
                                       name: '#[KMK002_40]',
                                       value: formulaName,
                                       enable: $parent.isUsed, 
                                       constraint: 'FormulaName',
                                       option: {width: '130'},
                                       required: true}"/>
                                    </td>
                                    <td>
                                       <div tabindex="1" data-bind="ntsSwitchButton: {
                                          name: '#[KMK002_41]',
                                          options: calcAtrDs,
                                          optionsValue: 'value',
                                          optionsText: 'localizedName',
                                          value: calcAtr,
                                          enable: orderNo() == 1 ? false : ($parent.isUsed() == true ? true : false)}"></div>
                                    </td>
                                    <td>
                                       <com:ko tag="if" bind="!isFormulaSettingSelected()">
                                          <button tabindex="1" class="btn-calc-set"
                                          data-bind="click: openDialogC, enable: $parent.isUsed"></button>
                                       </com:ko>
                                       <com:ko tag="if" bind="isFormulaSettingSelected()">
                                          <button tabindex="1" class="btn-calc-set"
                                          data-bind="click: openDialogD, enable: $parent.isUsed"></button>
                                       </com:ko>
                                    </td>
                                    <td>
                                       <input class="inp-formula-required"
                                       data-bind="attr: {'id': 'settingResult' + ($index() + 1)},
                                       ntsTextEditor: {
                                          name: '#[KMK002_35]',
                                          value: settingResult,
                                          readonly: true,
                                          enable: $parent.isUsed, 
                                          required: true}"/>
                                    </td>
                                    <td>
                                    	<com:ko tag="if" bind="isTimeSelected()">
                                       <div tabindex="1" style="width: 100px" class="combo-table" data-bind="ntsComboBox: {
                                          name: '#[KMK002_36]',
                                          options: timeUnitDs,
                                          optionsValue: 'value',
                                          value: timeDailyUnit,
                                          optionsText: 'localizedName',
                                          enable: $parent.isDailyRoundingEnabled(),
                                          columns: [
                                          { prop: 'localizedName', length: 5 },
                                          ]}">
                                       </div>
                                       </com:ko>
                                       <com:ko tag="if" bind="isAmountSelected()">
                                       <div tabindex="1" style="width: 100px" class="combo-table" data-bind="ntsComboBox: {
                                          name: '#[KMK002_36]',
                                          options: amountUnitDs,
                                          optionsValue: 'value',
                                          value: amountDailyUnit,
                                          optionsText: 'localizedName',
                                          enable: $parent.isDailyRoundingEnabled(),
                                          columns: [
                                          { prop: 'localizedName', length: 5 },
                                          ]}">
                                       </div>
                                       </com:ko>
                                       <com:ko tag="if" bind="isNumberSelected()">
                                       <div tabindex="1" style="width: 100px" class="combo-table" data-bind="ntsComboBox: {
                                          name: '#[KMK002_36]',
                                          options: numberUnitDs,
                                          optionsValue: 'value',
                                          value: numberDailyUnit,
                                          optionsText: 'localizedName',
                                          enable: $parent.isDailyRoundingEnabled(),
                                          columns: [
                                          { prop: 'localizedName', length: 5 },
                                          ]}">
                                       </div>
                                       </com:ko>
                                    </td>
                                    <td>
                                    	<com:ko tag="if" bind="isTimeSelected()">
                                       <div tabindex="1" style="width: 140px" class="combo-table" data-bind="ntsComboBox: {
                                          name: '#[KMK002_37]',
                                          options: timeRoundingDailyDs,
                                          optionsValue: 'value',
                                          value: timeDailyRounding,
                                          optionsText: 'localizedName',
                                          enable: $parent.isDailyRoundingEnabled(),
                                          columns: [
                                          { prop: 'localizedName', length: 8 },
                                          ]}">
                                       </div>
                                       </com:ko>
                                    	<com:ko tag="if" bind="isNumberSelected()">
                                       <div tabindex="1" style="width: 140px" class="combo-table" data-bind="ntsComboBox: {
                                          name: '#[KMK002_37]',
                                          options: numberRoundingDs,
                                          optionsValue: 'value',
                                          value: numberDailyRounding,
                                          optionsText: 'localizedName',
                                          enable: $parent.isDailyRoundingEnabled(),
                                          columns: [
                                          { prop: 'localizedName', length: 8 },
                                          ]}">
                                       </div>
                                       </com:ko>
                                    	<com:ko tag="if" bind="isAmountSelected()">
                                       <div tabindex="1" style="width: 140px" class="combo-table" data-bind="ntsComboBox: {
                                          name: '#[KMK002_37]',
                                          options: amountRoundingDs,
                                          optionsValue: 'value',
                                          value: amountDailyRounding,
                                          optionsText: 'localizedName',
                                          enable: $parent.isDailyRoundingEnabled(),
                                          columns: [
                                          { prop: 'localizedName', length: 8 },
                                          ]}">
                                       </div>
                                       </com:ko>
                                    </td>
                                    <td>
                                    <com:ko tag="if" bind="isTimeSelected()">
                                       <div tabindex="1" style="width: 100px" class="combo-table" data-bind="ntsComboBox: {
                                          name: '#[KMK002_38]',
                                          options: timeUnitDs,
                                          optionsValue: 'value',
                                          value: timeMonthlyUnit,
                                          optionsText: 'localizedName',
                                          enable: $parent.isUsed,
                                          columns: [
                                          { prop: 'localizedName', length: 5 },
                                          ]}">
                                       </div>
                                       </com:ko>
                                    <com:ko tag="if" bind="isNumberSelected()">
                                       <div tabindex="1" style="width: 100px" class="combo-table" data-bind="ntsComboBox: {
                                          name: '#[KMK002_38]',
                                          options: numberUnitDs,
                                          optionsValue: 'value',
                                          value: numberMonthlyUnit,
                                          optionsText: 'localizedName',
                                          enable: $parent.isUsed,
                                          columns: [
                                          { prop: 'localizedName', length: 5 },
                                          ]}">
                                       </div>
                                       </com:ko>
                                    <com:ko tag="if" bind="isAmountSelected()">
                                       <div tabindex="1" style="width: 100px" class="combo-table" data-bind="ntsComboBox: {
                                          name: '#[KMK002_38]',
                                          options: amountUnitDs,
                                          optionsValue: 'value',
                                          value: amountMonthlyUnit,
                                          optionsText: 'localizedName',
                                          enable: $parent.isUsed,
                                          columns: [
                                          { prop: 'localizedName', length: 5 },
                                          ]}">
                                       </div>
                                       </com:ko>
                                    </td>
                                    <td>
                                    <com:ko tag="if" bind="isTimeSelected()">
                                       <div tabindex="1" style="width: 140px" class="combo-table" data-bind="ntsComboBox: {
                                          name: '#[KMK002_39]',
                                          options: timeRoundingMonthlyDs,
                                          optionsValue: 'value',
                                          value: timeMonthlyRounding,
                                          optionsText: 'localizedName',
                                          enable: $parent.isUsed,
                                          columns: [
                                          { prop: 'localizedName', length: 8 },
                                          ]}">
                                       </div>
                                       </com:ko>
                                    <com:ko tag="if" bind="isNumberSelected()">
                                       <div tabindex="1" style="width: 140px" class="combo-table" data-bind="ntsComboBox: {
                                          name: '#[KMK002_39]',
                                          options: numberRoundingDs,
                                          optionsValue: 'value',
                                          value: numberMonthlyRounding,
                                          optionsText: 'localizedName',
                                          enable: $parent.isUsed,
                                          columns: [
                                          { prop: 'localizedName', length: 8 },
                                          ]}">
                                       </div>
                                       </com:ko>
                                    <com:ko tag="if" bind="isAmountSelected()">
                                       <div tabindex="1" style="width: 140px" class="combo-table" data-bind="ntsComboBox: {
                                          name: '#[KMK002_39]',
                                          options: amountRoundingDs,
                                          optionsValue: 'value',
                                          value: amountMonthlyRounding,
                                          optionsText: 'localizedName',
                                          enable: $parent.isUsed,
                                          columns: [
                                          { prop: 'localizedName', length: 8 },
                                          ]}">
                                       </div>
                                       </com:ko>
                                    </td>
                                 </tr>
                              </com:ko>
                           </tbody>
                        </table>
                     </com:ko>
                  </div>
               </div>
            </com:ko>
         </ui:define>
      </ui:composition>
   </body>
</html>